@if (this.user.photoURL && !this.thisComponentLoaded && (this.loading$ | async)) {
	<img
			[src]="this.user.photoURL"
			style="display: none;"
			(load)="onPhotoLoaded()"
			(error)="onPhotoLoaded()"
	/>
}

<section class="container" [style.display]="((this.loading$ | async) && !this.thisComponentLoaded) ? 'none' : 'block'">
	@if (this.error) {
		<div class="error-message">{{ this.error }}</div>
	} @else if (this.thisComponentLoaded) {
		<h1>Profile</h1>

		<div class="profile-card">
			@if (this.user.photoURL) {
				<div class="avatar">
					<img [src]="this.user.photoURL" alt="avatar">
				</div>
			} @else {
				<div class="avatar placeholder">ðŸ‘¤</div>
			}

			<div class="info">
				<h2 class="name">{{ this.user.displayName }}</h2>
				<p class="email">{{ this.user.email }}</p>
			</div>
		</div>

		<div class="stats">
			@if (this.user.createdAt) {
				<div class="stat">
					<div class="label">Joined</div>
					<div class="value">
						{{ this.user.createdAt.toDate() | date:'mediumDate' }}
					</div>
				</div>
			}

			@if (this.user.lastLogin) {
				<div class="stat">
					<div class="label">Last Login</div>
					<div class="value">
						{{ this.user.lastLogin.toDate() | date:'medium' }}
					</div>
				</div>
			}

			@if (this.user.location) {
				<div>
					<small>Location: {{ this.user.location!.name || (this.user.location!.lat + ', ' + this.user.location!.lng) }}</small>
				</div>
			}
		</div>

		@if (this.myProfile) {
			<a routerLink="/my-profile/edit" class="edit-profile">Edit Profile</a>
		}

		<button type="button" (click)="toggleThreads()" [disabled]="(this.loading$ | async)">
			{{ this.showThreads ? 'Hide Threads' : 'Show Threads' }}
		</button>

		<button type="button" (click)="togglePosts()" [disabled]="(this.loading$ | async)">
			{{ this.showPosts ? 'Hide Posts' : 'Show Posts' }}
		</button>
	}
	@if (!this.error && this.showThreads) {
		<section class="my-threads-section">
			<app-user-profile-threads-list (loadingStateChanged)="detectChanges()"></app-user-profile-threads-list>
		</section>
	}

	@if (!this.error && this.showPosts) {
		<section class="my-threads-section">
			<app-user-profile-posts-list (loadingStateChanged)="detectChanges()"></app-user-profile-posts-list>
		</section>
	}
</section>